<!doctype html>
<html>
<head>
  <title>Test AudioContext.suspend() and AudioContext.resume()</title>
  <script src="../resources/js-test.js"></script>
  <script src="resources/compatibility.js"></script>
  <script src="resources/audio-testing.js"></script>
</head>

<body>
  <script>
    description("Test suspend/resume for an AudioContext");
    window.jsTestIsAsync = true;

    var context = new AudioContext();

    var audit = Audit.createTaskRunner();

    // Task: check the method interface.
    audit.defineTask('interface', function (done) {
      Should('typeof context.suspend()', typeof context.suspend).beEqualTo('function');
      Should('typeof context.resume()', typeof context.resume).beEqualTo('function');
      done();
    });

    // Task: check the promise resolution.
    audit.defineTask('promise-resolution', function (done) {
      Should('context.suspend()', context.suspend()).beResolved().then(done);

      // Resuming the context cannot be tested with the trybot or the Content
      // Shell because it requires the physical audio device to run.
    });

    // Task: test corner cases.
    audit.defineTask('corner-cases', function (done) {

      Should('Calling multiple context.suspend()', function() {
        context.suspend();
        context.suspend();
      }).notThrow();

      context.close().then(function () {
        Should('Calling context.suspend() after close()', context.suspend())
          .beRejected();

        Should('Calling context.resume() after close()', context.resume())
          .beRejected().then(done);
      });

    });

    audit.defineTask('finish-test', function (done) {
      done();
      finishJSTest();
    });

    audit.runTasks(
      'interface',
      'promise-resolution',
      'corner-cases',
      'finish-test'
    );

    successfullyParsed = true;
  </script>
</body>
</html>
